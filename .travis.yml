# reference: https://github.com/numba/numba/blob/master/.travis.yml

dist: trusty

env:
    global:
        - GIT_DESCRIBE_TAG=0.29.2
        - GIT_DESCRIBE_NUMBER=1
        - PYTHON_VER=3.7
        - NUMPY_VER=1.16
        - CONDA_PREFIX_PATH=$HOME/miniconda
    matrix:
        - name: Ubuntu-16.04_py3.7_numpy1.16_np1
          env: SDC_NP_MPI=1
        - name: Ubuntu-16.04_py3.7_numpy1.16_np2
          env: SDC_NP_MPI=2
        - name: Ubuntu-16.04_py3.7_numpy1.16_np0_coverage
          env: SDC_RUN_COVERAGE=True

before_install:
    - buildscripts/setup_conda.sh $CONDA_PREFIX_PATH

install:
    - if [ "$SDC_RUN_COVERAGE" == "True" ]; then
          $CONDA_PREFIX_PATH/bin/python buildscripts/build.py --build-mode=develop --python=$PYTHON_VER --numpy=$NUMPY_VER --conda-prefix=$CONDA_PREFIX_PATH;
      else $CONDA_PREFIX_PATH/bin/python buildscripts/build.py --build-mode=package --python=$PYTHON_VER --numpy=$NUMPY_VER --conda-prefix=$CONDA_PREFIX_PATH;
      fi

script:
    - if [ "$SDC_RUN_COVERAGE" == "True" ]; then
          $CONDA_PREFIX_PATH/bin/python buildscripts/test.py --test-mode=develop --python=$PYTHON_VER --numpy=$NUMPY_VER --conda-prefix=$CONDA_PREFIX_PATH --run-coverage;
      else $CONDA_PREFIX_PATH/bin/python buildscripts/test.py --test-mode=conda --python=$PYTHON_VER --numpy=$NUMPY_VER --conda-prefix=$CONDA_PREFIX_PATH;
      fi

after_success: skip

notifications:
    email: false
