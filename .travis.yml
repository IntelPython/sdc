# reference: https://github.com/numba/numba/blob/master/.travis.yml

dist: trusty

env:
    global:
        - GIT_DESCRIBE_TAG=0.29.2
        - GIT_DESCRIBE_NUMBER=1
        - CONDA_ENV=travisci
        - PYTHON_VER=3.7
        - NUMPY_VER=1.16
    matrix:
        - HPAT_CHECK_STYLE=True
        - HPAT_RUN_BUILD=True HPAT_WHEELS=True
        - HPAT_RUN_BUILD=True HPAT_RUN_COVERAGE=True
        - HPAT_RUN_BUILD=True HPAT_CONFIG_MPI=False
matrix:
    allow_failures:
        - env: HPAT_CHECK_STYLE=True
        - env: HPAT_RUN_BUILD=True HPAT_CONFIG_MPI=False

before_install:
    - buildscripts/setup_conda.sh
    - export PATH=$HOME/miniconda3/bin:$PATH
    - if [ "$HPAT_CHECK_STYLE" == "True" ]; then
        wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key | sudo apt-key add -;
        sudo apt-add-repository "deb http://apt.llvm.org/bionic/ llvm-toolchain-bionic-6.0 main";
        sudo apt update && sudo apt install clang-6.0;
      fi

install:
    - export PATH=$HOME/miniconda3/bin:$PATH
    - export HPAT_SOURCE_DIR="$(pwd)/hpat"
    - env | grep HPAT_SOURCE_DIR
    - export HPAT_WHEELS_DIR="$(pwd)/hpat-wheels"
    - env | grep HPAT_WHEELS_DIR
    - mkdir $HPAT_WHEELS_DIR
    - if [ "$HPAT_RUN_BUILD" == "True" ]; then
          buildscripts/build.sh;
      fi

script:
    - export PATH=$HOME/miniconda3/bin:$PATH
    - if [ "$HPAT_CHECK_STYLE" == "True" ]; then
          chmod 777 buildscripts/code_style.sh;
          buildscripts/code_style.sh;
      fi

after_success: skip

notifications:
    email: false
