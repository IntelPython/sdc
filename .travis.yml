# reference: https://github.com/numba/numba/blob/master/.travis.yml

dist: trusty

env:
    global:
        - GIT_DESCRIBE_TAG=0.29.2
        - GIT_DESCRIBE_NUMBER=1
        - CONDA_ENV=travisci
        - PYTHON_VER=3.7
        - RUN_TEST=--no-test
    matrix:
        - HPAT_CHECK_STYLE=True
        - HPAT_RUN_COVERAGE=True
        allow_failures:
            - HPAT_CONFIG_MPI=False RUN_TEST=""

before_install:
    - buildscripts/setup_conda.sh
    - export PATH=$HOME/miniconda3/bin:$PATH
    - if [ "$HPAT_RUN_COVERAGE" == "True" ]; then conda install -y coveralls; fi
    - if [ "$HPAT_CHECK_STYLE" == "True" ]; then conda install -y numpy -c conda-forge; fi

install:
    - export PATH=$HOME/miniconda3/bin:$PATH
    - if [ "$HPAT_RUN_COVERAGE" == "True" ]; then buildscripts/build.sh; fi

script:
    - export PATH=$HOME/miniconda3/bin:$PATH
    - if [ "$HPAT_CHECK_STYLE" == "True" ]; then source activate $CONDA_ENV; python ./setup.py style; fi
    - if [ "$HPAT_RUN_COVERAGE" == "True" ]; then buildscripts/coverage.sh; fi

after_success:
    - export PATH=$HOME/miniconda3/bin:$PATH
    - if [ "$HPAT_RUN_COVERAGE" == "True" ]; then source activate $CONDA_ENV; coverage combine; coveralls -v; fi

notifications:
    email: false
