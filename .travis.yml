# reference: https://github.com/numba/numba/blob/master/.travis.yml

dist: trusty

env:
    global:
        - GIT_DESCRIBE_TAG=0.29.2
        - GIT_DESCRIBE_NUMBER=1
        - PYTHON_VER=3.7
        - NUMPY_VER=1.16
        - CONDA_PREFIX_PATH=$HOME/miniconda3
        - SDC_RUN_COVERAGE=""
        - BUILD_MODE=package
        - TEST_MODE=conda
    matrix:
        - name: Ubuntu-16.04_py3.7_numpy1.16_np1
          env: SDC_NP_MPI=1
        - name: Ubuntu-16.04_py3.7_numpy1.16_np2
          env: SDC_NP_MPI=2
        - name: Ubuntu-16.04_py3.7_numpy1.16_np3
          env: SDC_NP_MPI=3
        - name: Ubuntu-16.04_py3.7_numpy1.16_np0_coverage
          env: BUILD_MODE=develop TEST_MODE=develop SDC_RUN_COVERAGE="--run-coverage"

before_install:
    - chmod 777 buildscripts/install_conda.sh
    - buildscripts/install_conda.sh $CONDA_PREFIX_PATH

install:
    - travis_wait 40 $CONDA_PREFIX_PATH/bin/python buildscripts/build.py --build-mode=$BUILD_MODE --python=$PYTHON_VER --numpy=$NUMPY_VER --conda-prefix=$CONDA_PREFIX_PATH

script:
    - travis_wait $CONDA_PREFIX_PATH/bin/python buildscripts/test.py --test-mode=$TEST_MODE --python=$PYTHON_VER --numpy=$NUMPY_VER --conda-prefix=$CONDA_PREFIX_PATH $SDC_RUN_COVERAGE

after_success: skip

notifications:
    email: false
